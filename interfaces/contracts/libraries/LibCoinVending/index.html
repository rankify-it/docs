<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://rankify.it/interfaces/contracts/libraries/LibCoinVending/" />
      <link rel="shortcut icon" href="../../../../img/favicon.ico" />
    <title>Solidity API - Rankify Documentation</title>
    <link rel="stylesheet" href="../../../../css/theme.css" />
    <link rel="stylesheet" href="../../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Solidity API";
        var mkdocs_page_input_path = "interfaces/contracts/libraries/LibCoinVending.md";
        var mkdocs_page_url = "/interfaces/contracts/libraries/LibCoinVending/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/solidity.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/typescript.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/bash.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../../.." class="icon icon-home"> Rankify Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Welcome</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../..">Getting started</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../governance/">Governance</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../tokens/">Token types</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Architecture</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../architecture/">Smart contract infrastructure</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../architecture/applications/">Applications</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../architecture/specifications/">Specifications</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">interfaces</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../*">None</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../js/">JavaScript SDK</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Support</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../support/">Community channels</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../support/faq/">Frequently asked questions</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../..">Rankify Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../.." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Solidity API</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/rankify-it/edit/master/docs/interfaces/contracts/libraries/LibCoinVending.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="solidity-api">Solidity API<a class="headerlink" href="#solidity-api" title="Permanent link">#</a></h1>
<h2 id="libcoinvending">LibCoinVending<a class="headerlink" href="#libcoinvending" title="Permanent link">#</a></h2>
<p>_This library is used to simulate the vending machine coin acceptor state machine that:
 - Supports large number of positions; Each represents requirements to acess different goods of the virtual vending machine.
 - Accepts multiple assets of following types: Native (Eth), ERC20, ERC721, and ERC1155 tokens that can be stacked together.
 - Allows for each individual asset action promise can be one of following:
     - Lock: The asset is locked in the acceptor with promise that asset will be returned to the sender at release funds time.
     - Bet: The asset is locked in the acceptor with promise that asset will be awarded to benificiary at release funds time.
     - Pay: The asset is locked in the acceptor with promise that asset will be paid to payee at release funds time.
     - Burn: The asset is locked in the acceptor with promise that asset will be destroyed at release funds time.
 - Maintains each position balance, hence allowing multiple participants to line up for the same position.
 - Allows three actions:
     - Fund position with assets
     - Refund assets to user
     - Consume assets and provide goods to user
     - Consuming asset might take a form of
     - Transferring assets to payee
     - Burning assets
     - Awarding beneficiary with assets
     - Returning locked assets back to sender</p>
<p>This library DOES enforces that any position can only be refunded or processed only within amount funded boundaries
This library DOES NOT store the addresses of senders, nor benificiaries, nor payees.
This is to be stored within implementation contract.</p>
<p>!!!!! IMPORTANT !!!!!
This library does NOT invocates reentrancy guards. It is implementation contract's responsibility to enforce reentrancy guards.
Reentrancy guards MUST be implemented in an implementing contract.</p>
<p>Usage:</p>
<ol>
<li>Configure position via configure(...)</li>
<li>fund position with assets via fund(...)</li>
<li>release or refund assets via release(...) or refund(...)</li>
<li>repeat steps 1 and 2 as needed.
 Position can be recofigured at any time when it's effective balance is zero: <code>timesFunded - timesRefuned - timesReleased = 0</code></li>
</ol>
<p>Test state:
This library most functionality has been tested: see ../tests/LibCoinVending.ts and ../tests/report.md for details.</p>
<p>ERC721 token is checked only for "HAVE" condition since putting requirements on non fungable token id yet to be resolved.
(see ERC721 section in the code below)</p>
<p>This library has not been yet audited_</p>
<h3 id="condition">Condition<a class="headerlink" href="#condition" title="Permanent link">#</a></h3>
<pre class="highlight"><code class="language-solidity">struct Condition {
  mapping(enum LibCoinVending.ContractTypes =&gt; mapping(address =&gt; mapping(uint256 =&gt; struct LibCoinVending.ContractCondition))) contracts;
  struct LibCoinVending.NumericCondition ethValues;
  uint256 timesRefunded;
  uint256 timesReleased;
  uint256 timesFunded;
  enum LibCoinVending.ContractTypes[] contractTypes;
  address[] contractAddresses;
  uint256[] contractIds;
  bool _isConfigured;
}</code></pre>
<h3 id="requirementtypes">RequirementTypes<a class="headerlink" href="#requirementtypes" title="Permanent link">#</a></h3>
<pre class="highlight"><code class="language-solidity">enum RequirementTypes {
  HAVE,
  LOCK,
  BURN,
  BET,
  PAY
}</code></pre>
<h3 id="transactionproperties">TransactionProperties<a class="headerlink" href="#transactionproperties" title="Permanent link">#</a></h3>
<pre class="highlight"><code class="language-solidity">struct TransactionProperties {
  bytes data;
  uint256 amount;
}</code></pre>
<h3 id="contractcondition">ContractCondition<a class="headerlink" href="#contractcondition" title="Permanent link">#</a></h3>
<pre class="highlight"><code class="language-solidity">struct ContractCondition {
  struct LibCoinVending.TransactionProperties have;
  struct LibCoinVending.TransactionProperties lock;
  struct LibCoinVending.TransactionProperties burn;
  struct LibCoinVending.TransactionProperties pay;
  struct LibCoinVending.TransactionProperties bet;
}</code></pre>
<h3 id="numericcondition">NumericCondition<a class="headerlink" href="#numericcondition" title="Permanent link">#</a></h3>
<pre class="highlight"><code class="language-solidity">struct NumericCondition {
  uint256 have;
  uint256 lock;
  uint256 burn;
  uint256 pay;
  uint256 bet;
}</code></pre>
<h3 id="transfertypes">TransferTypes<a class="headerlink" href="#transfertypes" title="Permanent link">#</a></h3>
<pre class="highlight"><code class="language-solidity">enum TransferTypes {
  FUND,
  REFUND,
  RELEASE
}</code></pre>
<h3 id="conditionreturn">ConditionReturn<a class="headerlink" href="#conditionreturn" title="Permanent link">#</a></h3>
<pre class="highlight"><code class="language-solidity">struct ConditionReturn {
  struct LibCoinVending.NumericCondition ethValues;
  uint256 timesRefunded;
  uint256 timesReleased;
  uint256 timesFunded;
  address[] contractAddresses;
  uint256[] contractIds;
  enum LibCoinVending.ContractTypes[] contractTypes;
  bool _isConfigured;
}</code></pre>
<h3 id="configsmartrequirement">configSmartRequirement<a class="headerlink" href="#configsmartrequirement" title="Permanent link">#</a></h3>
<pre class="highlight"><code class="language-solidity">struct configSmartRequirement {
  address contractAddress;
  uint256 contractId;
  enum LibCoinVending.ContractTypes contractType;
  struct LibCoinVending.ContractCondition contractRequirement;
}</code></pre>
<h3 id="configposition">ConfigPosition<a class="headerlink" href="#configposition" title="Permanent link">#</a></h3>
<pre class="highlight"><code class="language-solidity">struct ConfigPosition {
  struct LibCoinVending.NumericCondition ethValues;
  struct LibCoinVending.configSmartRequirement[] contracts;
}</code></pre>
<h3 id="libcoinvendingstorage">LibCoinVendingStorage<a class="headerlink" href="#libcoinvendingstorage" title="Permanent link">#</a></h3>
<pre class="highlight"><code class="language-solidity">struct LibCoinVendingStorage {
  mapping(bytes32 =&gt; struct LibCoinVending.Condition) positions;
  address beneficiary;
}</code></pre>
<h3 id="contracttypes">ContractTypes<a class="headerlink" href="#contracttypes" title="Permanent link">#</a></h3>
<pre class="highlight"><code class="language-solidity">enum ContractTypes {
  ERC20,
  ERC1155,
  ERC721
}</code></pre>
<h3 id="coin_vending_storage_position">COIN_VENDING_STORAGE_POSITION<a class="headerlink" href="#coin_vending_storage_position" title="Permanent link">#</a></h3>
<pre class="highlight"><code class="language-solidity">bytes32 COIN_VENDING_STORAGE_POSITION</code></pre>
<h3 id="coinvendingposition">coinVendingPosition<a class="headerlink" href="#coinvendingposition" title="Permanent link">#</a></h3>
<pre class="highlight"><code class="language-solidity">function coinVendingPosition(bytes32 position) internal view returns (struct LibCoinVending.Condition)</code></pre>
<h3 id="coinvendingstorage">coinVendingStorage<a class="headerlink" href="#coinvendingstorage" title="Permanent link">#</a></h3>
<pre class="highlight"><code class="language-solidity">function coinVendingStorage() internal pure returns (struct LibCoinVending.LibCoinVendingStorage es)</code></pre>
<h3 id="refund">refund<a class="headerlink" href="#refund" title="Permanent link">#</a></h3>
<pre class="highlight"><code class="language-solidity">function refund(bytes32 position, address to) internal</code></pre>
<p>_Returns all position requirements back to fundee. <code>position</code> is the identifier of the condition. <code>to</code> is the address to refund the balance to.</p>
<p>Requirements:</p>
<ul>
<li>The sum of <code>timesRefunded</code> and <code>timesReleased</code> for the condition must be less than <code>timesFunded</code>.</li>
</ul>
<p>Modifies:</p>
<ul>
<li>Transfers the remaining balance of the condition to the <code>to</code> address.</li>
<li>Increments the <code>timesRefunded</code> counter for the condition._</li>
</ul>
<h3 id="batchrefund">batchRefund<a class="headerlink" href="#batchrefund" title="Permanent link">#</a></h3>
<pre class="highlight"><code class="language-solidity">function batchRefund(bytes32 position, address[] returnAddresses) internal</code></pre>
<p>_Returns all position requirements back to multiple fundees. <code>position</code> is the identifier of the condition. <code>returnAddresses</code> is an array of addresses to refund the balance to.</p>
<p>Requirements:</p>
<ul>
<li>The sum of <code>timesRefunded</code> and <code>timesReleased</code> for the condition must be less than <code>timesFunded</code>.</li>
</ul>
<p>Modifies:</p>
<ul>
<li>Transfers the remaining balance of the condition to each address in <code>returnAddresses</code>.</li>
<li>Increments the <code>timesRefunded</code> counter for the condition for each address in <code>returnAddresses</code>._</li>
</ul>
<h3 id="release">release<a class="headerlink" href="#release" title="Permanent link">#</a></h3>
<pre class="highlight"><code class="language-solidity">function release(bytes32 position, address payee, address beneficiary, address returnAddress) internal</code></pre>
<p>_Releases the funds from a coin vending position to the specified addresses. <code>position</code> is the identifier of the condition. <code>payee</code>, <code>beneficiary</code>, and <code>returnAddress</code> are the addresses to release the funds to.</p>
<p>Requirements:</p>
<ul>
<li>The sum of <code>timesRefunded</code> and <code>timesReleased</code> for the condition must be less than <code>timesFunded</code>.</li>
</ul>
<p>Modifies:</p>
<ul>
<li>Transfers the remaining balance of the condition to the <code>payee</code>, <code>beneficiary</code>, and <code>returnAddress</code>.</li>
<li>Increments the <code>timesReleased</code> counter for the condition._</li>
</ul>
<h3 id="batchrelease">batchRelease<a class="headerlink" href="#batchrelease" title="Permanent link">#</a></h3>
<pre class="highlight"><code class="language-solidity">function batchRelease(bytes32 position, address payee, address beneficiary, address[] returnAddresses) internal</code></pre>
<p>_Releases the funds from a coin vending position to multiple return addresses. <code>position</code> is the identifier of the condition. <code>payee</code>, <code>beneficiary</code>, and <code>returnAddresses</code> are the addresses to release the funds to.</p>
<p>Requirements:</p>
<ul>
<li>The sum of <code>timesRefunded</code> and <code>timesReleased</code> for the condition must be less than <code>timesFunded</code>.</li>
</ul>
<p>Modifies:</p>
<ul>
<li>Transfers the remaining balance of the condition to the <code>payee</code>, <code>beneficiary</code>, and each address in <code>returnAddresses</code>.</li>
<li>Increments the <code>timesReleased</code> counter for the condition for each address in <code>returnAddresses</code>._</li>
</ul>
<h3 id="fund">fund<a class="headerlink" href="#fund" title="Permanent link">#</a></h3>
<pre class="highlight"><code class="language-solidity">function fund(bytes32 position) internal</code></pre>
<p>_Funds the position by <code>msg.sender</code>. <code>position</code> is the identifier of the condition.</p>
<p>Requirements:</p>
<ul>
<li>The condition must be configured.</li>
</ul>
<p>Modifies:</p>
<ul>
<li>Transfers the funds from <code>msg.sender</code> to this contract.</li>
<li>Increments the <code>timesFunded</code> counter for the condition._</li>
</ul>
<h3 id="configure">configure<a class="headerlink" href="#configure" title="Permanent link">#</a></h3>
<pre class="highlight"><code class="language-solidity">function configure(bytes32 position, struct LibCoinVending.ConfigPosition configuration) internal</code></pre>
<p>_Configures the position. <code>position</code> is the identifier of the condition. <code>configuration</code> is the new configuration for the condition.</p>
<p>Requirements:</p>
<ul>
<li>The condition must not have a positive balance.</li>
</ul>
<p>Modifies:</p>
<ul>
<li>Sets the configuration of the condition to <code>configuration</code>._</li>
</ul>
<h3 id="getposition">getPosition<a class="headerlink" href="#getposition" title="Permanent link">#</a></h3>
<pre class="highlight"><code class="language-solidity">function getPosition(bytes32 position) internal view returns (struct LibCoinVending.ConditionReturn)</code></pre>
<p>_Returns the condition associated with the given position. <code>position</code> is the identifier of the condition.</p>
<p>Returns:</p>
<ul>
<li>The condition associated with <code>position</code>._</li>
</ul>
<h3 id="getpositionbycontract">getPositionByContract<a class="headerlink" href="#getpositionbycontract" title="Permanent link">#</a></h3>
<pre class="highlight"><code class="language-solidity">function getPositionByContract(bytes32 position, address contractAddress, uint256 contractId, enum LibCoinVending.ContractTypes contractType) internal view returns (struct LibCoinVending.ContractCondition)</code></pre>
<p>_Returns the contract condition associated with the given position, contract address, contract ID, and contract type. <code>position</code> is the identifier of the condition. <code>contractAddress</code> is the address of the contract. <code>contractId</code> is the ID of the contract. <code>contractType</code> is the type of the contract.</p>
<p>Returns:</p>
<ul>
<li>The contract condition associated with <code>position</code>, <code>contractAddress</code>, <code>contractId</code>, and <code>contractType</code>._</li>
</ul>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/rankify-it" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../../../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../../../..";</script>
    <script src="../../../../js/theme_extra.js"></script>
    <script src="../../../../js/theme.js"></script>
      <script src="../../../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
